version: '3.8'

services:
  k8s-tools:
    build: .
    image: k8s-tools:latest
    container_name: k8s-tools
    # Mount your kubectl config and other necessary files
    volumes:
      # Mount your kubectl configuration
      - ~/.kube:/home/k8suser/.kube:ro
      # Mount current directory for accessing manifests
      - .:/workspace
      # Optional: Mount AWS credentials if using EKS
      # - ~/.aws:/home/k8suser/.aws:ro
      # Optional: Mount GCP credentials if using GKE
      # - ~/.config/gcloud:/home/k8suser/.config/gcloud:ro
    working_dir: /workspace
    # Keep container running for interactive use
    stdin_open: true
    tty: true
    # Network mode for accessing local services
    network_mode: host
    
  # Alternative service for one-off commands
  k8s-tools-cmd:
    build: .
    image: k8s-tools:latest
    volumes:
      - ~/.kube:/home/k8suser/.kube:ro
      - .:/workspace
    working_dir: /workspace
    # This will be overridden by docker-compose run commands
    command: ["kubectl", "version", "--client"]